{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-12 d-flex justify-content-between align-items-center mb-4">
        <h2>Modifier les libellés - Thème {{ template.theme }} (V{{ template.version }})</h2>
        <a href="{{ url_for('admin_forms') }}" class="btn btn-secondary">Annuler</a>
    </div>
</div>

<div class="alert alert-info">
    Modifier ces libellés créera automatiquement une <strong>nouvelle version (V{{ template.version + 1 }})</strong>.
    Les saisies déjà effectuées sur la version actuelle resteront liées à la V{{ template.version }}.
</div>

<div class="card shadow">
    <div class="card-body">
        <form method="post">
            {% if template.structure.type == 'budget' %}
                {% for group in template.structure.groups %}
                    <h5 class="mt-4 border-bottom">{{ group.title }}</h5>
                    {% for field in group.fields %}
                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">{{ field.id }}</label>
                        <div class="col-sm-{% if field.multiplier is defined or field.formula is defined %}4{% else %}8{% endif %}">
                            <input type="text" name="label_{{ field.id }}" class="form-control" value="{{ field.label }}" placeholder="Libellé">
                        </div>
                        {% if field.multiplier is defined %}
                        <div class="col-sm-4">
                            <div class="input-group">
                                <span class="input-group-text">Mult :</span>
                                <input type="number" step="0.01" name="mult_{{ field.id }}" class="form-control" value="{{ field.multiplier }}">
                            </div>
                        </div>
                        {% endif %}
                        {% if field.formula is defined %}
                        <div class="col-sm-4">
                            <div class="input-group">
                                <span class="input-group-text">Formule :</span>
                                <input type="text" name="formula_{{ field.id }}" class="form-control" value="{{ field.formula }}">
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% endfor %}

            {% elif template.structure.type == 'fixed_table' %}
                {% for row in template.structure.rows %}
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">{{ row.id }}</label>
                    <div class="col-sm-8">
                        <input type="text" name="label_{{ row.id }}" class="form-control" value="{{ row.label }}">
                    </div>
                </div>
                {% endfor %}

            {% elif template.structure.type == 'dynamic_table' %}
                {% for col in template.structure.cols %}
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">{{ col.id }}</label>
                    <div class="col-sm-8">
                        <input type="text" name="label_{{ col.id }}" class="form-control" value="{{ col.label }}">
                    </div>
                </div>
                {% endfor %}
            {% endif %}

            <div class="mt-4 d-grid">
                <button type="submit" class="btn btn-royal btn-lg">Enregistrer et créer la nouvelle version</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
